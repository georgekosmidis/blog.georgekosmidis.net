<p>The Azure Document Intelligence API offers powerful capabilities for form recognition and document analysis. However, the client library for JavaScript that offers ease of usage might not always align with your needs, especially when it comes to using preview versions of the API. In this blog post, we'll explore how to override the default API version used by the Azure Document Intelligence SDK to leverage the latest preview features.</p>
<h1 id="why-override-the-default-api-version">Why Override the Default API Version?</h1>
<ul>
<li><strong>Access to New Features</strong>: Preview versions often include cutting-edge features not yet available in the stable release.</li>
<li><strong>Customization</strong>: Tailor the API behavior to suit specific project requirements.</li>
<li><strong>Future-proofing</strong>: Stay ahead of the curve by testing and integrating new capabilities early.</li>
</ul>
<h1 id="steps-to-implement-custom-api-version-override">Steps to Implement Custom API Version Override</h1>
<h2 id="creating-the-custom-policy-class">1. Creating the Custom Policy Class</h2>
<p>The first step is to create a custom policy that overrides the default API version in the request URL.</p>
<pre><code class="language-typescript">import { PipelinePolicy, PipelineRequest, PipelineResponse, SendRequest } from '@azure/core-rest-pipeline';

export class OverrideCustomApiVersionPolicy implements PipelinePolicy {
  name: string = 'OverrideCustomApiVersionPolicy';
  constructor(private apiVersion: string) {}

  sendRequest(request: PipelineRequest, next: SendRequest): Promise&lt;PipelineResponse&gt; {
    const url = new URL(request.url);
    url.searchParams.set('api-version', this.apiVersion);
    request.url = url.toString().replace('formrecognizer', 'documentintelligence');
    var response = next(request);
    console.info(`Azure Document Intelligence Request: ${request.url}`);
    return response;
  }
}
</code></pre>
<h2 id="overriding-the-default-documentanalysisclient">2. Overriding the Default DocumentAnalysisClient</h2>
<p>Next, we'll override the default <code>DocumentAnalysisClient</code> to incorporate our custom policy.</p>
<pre><code class="language-typescript">import { DocumentAnalysisClient } from '@azure/ai-form-recognizer';
import { DocumentAnalysisClientOptionsPreview } from './DocumentAnalysisClientOptionsPreview';
import { OverrideCustomApiVersionPolicy } from './OverrideCustomApiVersionPolicy';
import { TokenCredential } from '@azure/identity';

export class DocumentAnalysisClientPreview extends DocumentAnalysisClient {
  constructor(endpoint: string, credential: TokenCredential, options: DocumentAnalysisClientOptionsPreview) {
    super(endpoint, credential, options);
    if (!options.additionalPolicies) {
      options.additionalPolicies = [];
    }
    const policy = new OverrideCustomApiVersionPolicy(options.apiVersion);

    // Add policy to the end of the pipeline to override the URL
    // @ts-ignore
    this._restClient.pipeline.addPolicy(policy);
  }
}
</code></pre>
<h2 id="defining-custom-options">3. Defining Custom Options</h2>
<p>We also need to define a custom options interface to include the API version.</p>
<pre><code class="language-typescript">import { DocumentAnalysisClientOptions } from '@azure/ai-form-recognizer';

export interface DocumentAnalysisClientOptionsPreview extends DocumentAnalysisClientOptions {
  apiVersion: string;
}
</code></pre>
<h2 id="using-the-custom-client">4. Using the Custom Client</h2>
<p>Finally, we instantiate and use the custom client in our application.</p>
<pre><code class="language-javascript">const client = new DocumentAnalysisClientPreview(
  process.env.AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT, 
  tokenResolver.getToken(), 
  { apiVersion: '2024-05-01-preview' }
);
</code></pre>
<h1 id="conclusion">Conclusion</h1>
<p>Although not perfect since it does not include potential model changes, implementing a custom API version override allows you to unlock preview versions of the Azure Document Intelligence API, access the latest features, and ensure your application remains at the forefront of technology - at least during development.
Just keep in mind that this is NOT a production solution, as preview versions can change or be withdrawn without notice!</p>
